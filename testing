import telnetlib
import time

host = "192.168.56.101"
username = "tufan"
password = "123"

tn = telnetlib.Telnet(host)
print("connected to " + host)

tn.read_until(b"Username:")
tn.write((username + "\n").encode())
time.sleep(1)
output = tn.read_until(b"Password:").decode()
if "Password:" not in output:
    print('failed to enter username:', username)
    exit()

tn.write((password + "\n").encode())
time.sleep(1)
output = tn.read_until(b"#").decode()
if "#" not in output:
    print('failed to enter password:', password)
    exit()

print('successfully connected to:', host)

tn.write("copy flash:CONFIG3 running-config\n".encode())
time.sleep(2)
tn.write("\n".encode())
time.sleep(3)
output = tn.read_until(b"#").decode()
print(output)

tn.write("show running-config | section line vty\n".encode())
time.sleep(3)
output = tn.read_until(b"#").decode()
print(output)

while True:
    command = input(output.splitlines()[-1])
    if command.lower() in ["exit", "quit"]:
        print("exiting telnet session...")
        tn.write("exit\n".encode())
        break
    
    tn.write((command + "\n").encode())
    time.sleep(1)
    output = tn.read_until(b">", timeout=5).decode()
    print(output)

tn.close()
print("connection closed.")
