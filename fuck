import pexpect
import sys

# Device connection details
ip_address = '192.168.56.101'
username = 'tufan'
password = '123'
enable_password = '123'

# Start SSH session (auto accept host key)
ssh_command = f"ssh -o StrictHostKeyChecking=no {username}@{ip_address}"
session = pexpect.spawn(ssh_command, encoding='utf-8', timeout=30)

# 1. SSH login
i = session.expect(['[Pp]assword:', pexpect.TIMEOUT, pexpect.EOF])
if i != 0:
    print(f"--- FAILURE: no password prompt connecting to {ip_address}")
    sys.exit(1)
session.sendline(password)

# 2. Enter enable mode
session.expect('>')
session.sendline('enable')
i = session.expect(['[Pp]assword:', pexpect.TIMEOUT, pexpect.EOF])
if i != 0:
    print("--- FAILURE: no enable prompt")
    sys.exit(1)
session.sendline(enable_password)
session.expect('#')

# 3. Enter config mode
session.sendline('configure terminal')
session.expect('\(config\)#')

# 4. Change hostname to R1
session.sendline('hostname R1')
session.expect('R1\(config\)#')

# 5. Cleanup and exit
session.sendline('end')  # back to privileged exec
session.sendline('exit') # back to shell
session.close()

print(f"--- SUCCESS: configured hostname to R1 on {ip_address}")
