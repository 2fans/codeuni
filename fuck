from netmiko import ConnectHandler
import telnetlib
import time

# === Device credentials ===
HOST = '192.168.56.101'
USERNAME = 'tufan'
PASSWORD = '123'

# --- Insecure connection via Telnet ---
def telnet_connection():
    # Connect
    tn = telnetlib.Telnet(HOST)
    print(f"[Telnet] Connected to {HOST}")

    # Login
    tn.read_until(b"Username:")
    tn.write(USERNAME.encode('ascii') + b"\n")
    tn.read_until(b"Password:")
    tn.write(PASSWORD.encode('ascii') + b"\n")

    # Enter enable mode
    tn.write(b"enable\n")
    tn.write(PASSWORD.encode('ascii') + b"\n")

    # Change hostname
    tn.write(b"configure terminal\n")
    tn.write(b"hostname TelnetDevice\n")
    tn.write(b"end\n")
    print("[Telnet] Hostname changed to TelnetDevice")

    # Show running-config and save locally
    tn.write(b"show running-config\n")
    time.sleep(1)
    output = tn.read_very_eager().decode('ascii')
    with open("telnet_running_config.txt", "w") as f:
        f.write(output)
    print("[Telnet] Running config saved to telnet_running_config.txt")

    # Close
    tn.write(b"exit\n")
    tn.close()

# --- Secure connection via SSH (Netmiko) ---
def ssh_connection():
    device = {
        'device_type': 'cisco_ios',
        'host': HOST,
        'username': USERNAME,
        'password': PASSWORD,
        'secret': PASSWORD,  # enable password
    }
    conn = ConnectHandler(**device)
    print(f"[SSH] Connected to {HOST}")

    # Enter enable
    conn.enable()

    # Change hostname
    conn.send_config_set(["hostname SSHDevice"])
    print("[SSH] Hostname changed to SSHDevice")

    # Show running-config and save locally
    output = conn.send_command("show running-config")
    with open("ssh_running_config.txt", "w") as f:
        f.write(output)
    print("[SSH] Running config saved to ssh_running_config.txt")

    conn.disconnect()

# --- Main menu ---
def main():
    print("Choose connection method:")
    print("1) Telnet (insecure)")
    print("2) SSH   (secure)")
    choice = input("Enter 1 or 2: ")

    if choice == '1':
        telnet_connection()
    elif choice == '2':
        ssh_connection()
    else:
        print("Invalid choice. Please enter 1 or 2.")

if __name__ == '__main__':
    main()
